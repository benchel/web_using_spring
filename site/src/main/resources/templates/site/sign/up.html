<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layout/site_layout}">
<head></head>
<th:block layout:fragment="script">
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', () => {
	setDefault();
	registEvent();
});

const setDefault = function() {
	
};

const registEvent = function() {
	// 제출 버튼에 이벤트 등록
	let btn_positive = document.querySelector('.btn_positive');
	btn_positive.addEventListener('click', validate);
	
	// 이메일 주소 목록에 이벤트 등록
	let em_list = document.querySelector('.em_list');
	em_list.addEventListener('change', select_mirror);
	
	// 취소 버튼에 이벤트 등록
	let btn_cancel = document.querySelector('.btn_cancel');
	btn_cancel.addEventListener('click', () => {
		location.href = '/';
	});
	
	// 비밀번호 입력란에 이벤트 등록
	let inp_pwd = document.querySelector('input[id="pwd"]');
	inp_pwd.addEventListener('keyup', check_pwd);
	
	// 아이디 입력란에 이벤트 등록
	let inp_id = document.querySelector('input[id="id"]');
	inp_id.addEventListener('keyup', chg_overlap_yes_no);
	
	// 아이디 중복 확인 버튼에 이벤트 등록
	let ch_overlap = document.querySelector('.checking-overlap');
	ch_overlap.addEventListener('click', check_overlap);
};

function validate() {
	// 아이디 확인
	let id = document.querySelector('input[id="id"]');
	if(!id.value) {
		alert("사용하실 아이디를 입력해주세요."); id.focus();
		return;
	}
	// 아이디 중복 확인을 마쳤는지 판별
	let ch_overlap = document.querySelector('.checking-overlap');
	if(!ch_overlap.res) {
		alert("아이디 중복 확인을 해주세요.");
		return;
	}
	
	// 이름 확인
	let name = document.querySelector('input[id="name"]');
	if(!name.value) {
		name.focus(); alert("이름을 입력해주세요.");
		return;
	}
	// 연락처 확인
	let contact = document.querySelector('input[id="contact"]');
	if(!contact.value) {
		contact.focus(); alert("연락처를 입력해주세요."); 
		return;
	} else {
		if(contact.value.length > 11) {
			alert("연락처가 허용된 길이(11)를 초과하였습니다."); contact.focus(); 
			return;
		}
	}
	// 이메일 확인
	let email = document.querySelector('input[id="email"]');
	let email_addr = document.querySelector('input[id="email_addr"]');
	
	if(!email.value) {
		email.focus(); alert("이메일을 입력해주세요."); return;
	} else if(!email_addr.value) {
		email_addr.focus(); alert("이메일을 입력해주세요."); return;
	}
	
};

// select 태그에서 선택한 값을 input의 value에 반영
function select_mirror(e) {
	let val = e.target.value;
	let email_addr = document.querySelector('input[id="email_addr"]');
	
	if(val == '직접입력') {
		email_addr.value = '';
		email_addr.style.visibility = 'visible';
	} else {
		email_addr.value = val;
		email_addr.style.visibility = 'hidden';
	}
};

function check_pwd(e) {
	const regs = /[A-Za-z]{1,}?[0-9]{1,}?|[A-Za-z]{1,}?[!@#$%^&*()-_=+]{1,}?|[0-9]{1,}?[!@#$%^&*()-_=+]{1,}?/;
	let result = regs.exec(e.target.value);
	
	let pwd_instr = document.querySelector('.pwd_instr');
	
	if(result == null) {
		pwd_instr.style.color = 'red';
	} else {
		pwd_instr.style.color = 'black';
	}
};

function chg_overlap_yes_no(e) {
	let btn_ch_overlap = document.querySelector('.checking-overlap');
	
	if(btn_ch_overlap.res) {
		btn_ch_overlap.style.color = 'black';
		btn_ch_overlap.res = false;
	}
};

function check_overlap(e) {
	let user_id = document.querySelector('input[id="id"]');
	let user_id_val = user_id.value;
	
	if(user_id_val == '' || user_id_val == null) {
		alert("아이디를 입력하여 주십시오.");
		user_id.focus();
		return;
	}
	
	let formData = {
		'id' : user_id_val
	};

	fetch('/site/sign/up/check/overlap', {
		'method' : 'POST',
		headers : {'Content-Type' : 'application/json'},
		body : JSON.stringify(formData),
	})
	.then(response => response.json())
	.then((data) => {
		let result = data.result;
		let msg = data.msg;
		
		if(result == true) {
			alert(msg);
			e.target.res = true;
			e.target.style.color = 'green';
		} else {
			alert(msg);
			user_id.value = '';
			user_id.focus();
		}
	})
	.catch((error) => {
		alert("데이터를 가지고 오는데 실패하였습니다.");
		console.log(error);
	});
	
};
</script>
</th:block>
<th:block layout:fragment="contents">
	<div id="contents">

        <p><h3>회원가입</h3></p>

		<table class="sing-up-tbl">
			<tbody>
				<tr>
					<td>아이디</td>
					<td>
                        <input type="text" id="id" name="id" maxlength="12" value="">
                        <button class="checking-overlap" res="false">중복확인</button>
                    </td>
				</tr>
                <tr>
                    <td>이름</td>
                    <td>
                        <input type="text" id="name" name="name" maxlength="20" value="">
                    </td>                                             
                </tr>                    
				<tr>
					<td>비밀번호</td>
					<td>
                        <input type="password" id="pwd" name="pwd" maxlength="20" value="">
                    </td>
				</tr>
				<tr>
					<td>비밀번호 확인</td>
					<td>
                        <input type="password" id="pwd_c" name="pwd_c" maxlength="20" value="">
                    </td>
				</tr>                    
                <tr>
                    <td colspan="2">
                        <span class="pwd_instr">비밀번호는 영문 대문자, 영문 소문자, 숫자, 특수문자(!@#$%^&*()_+) 중 2종류 이상을 조합해 10자리 이상, 20자리 이하의 길이로 구성하여 주십시오.</span>
                    </td>
                </tr>
                <tr>
                    <td>연락처</td>
                    <td>
                        <input type="number" id="contact" name="contact" value="" placeholder="-를 제외하고 입력">
                    </td>                                  
                </tr>                
                <tr>
                    <td>이메일</td>
                    <td>
                        <input type="text" id="email" name="email">
                        <select class="em_list">
                        	<option>직접입력</option>
                            <option value="naver.com">naver.com</option>
                            <option value="nate.com">nate.com</option>
                            <option value="google.com">google.com</option>
                        </selectlc>
                        <input type="text" id="email_addr" name="email_addr" value="">
                    </td>
                </tr> 
                <tr>
                    <td>인증번호</td>
                    <td>
                        <input type="text">
                        <button>인증번호 발송</button>
                        <button>확인</button>
                    </td>
                </tr>                                    
			</tbody>			
		</table>

        <div class="btn-group mg-top30px">
            <button class="btn_positive btn-sz-m flt-rt mg-rt10px">제출</button>
            <button class="btn_cancel btn-sz-m flt-rt mg-rt10px">취소</button>
        </div>
            
	</div>
</th:block>
</html>